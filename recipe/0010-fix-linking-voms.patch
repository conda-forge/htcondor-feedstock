From a622271b8076b1a9d81cd0c0cb00f0e4f4db8c1f Mon Sep 17 00:00:00 2001
From: "duncan.macleod" <duncan.macleod@ligo.org>
Date: Sat, 5 Nov 2022 16:59:39 +0000
Subject: [PATCH 10/11] fix linking voms

backport of https://github.com/htcondor/htcondor/pull/362
---
 externals/bundles/voms/2.0.13/CMakeLists.txt | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/externals/bundles/voms/2.0.13/CMakeLists.txt b/externals/bundles/voms/2.0.13/CMakeLists.txt
index f51e94db72..0aa24a1567 100644
--- a/externals/bundles/voms/2.0.13/CMakeLists.txt
+++ b/externals/bundles/voms/2.0.13/CMakeLists.txt
@@ -135,8 +135,11 @@ if ( WITH_VOMS )
 	else(NOT PROPER)
 
 		find_multiple( "vomsapi" VOMS_FOUND)
-		find_so_name( LIBVOMSAPI_SO ${VOMS_FOUND} )
-		set( LIBVOMSAPI_SO ${LIBVOMSAPI_SO} PARENT_SCOPE )
+
+		if (DLOPEN_VOMS_LIBS)
+			find_so_name( LIBVOMSAPI_SO ${VOMS_FOUND} )
+			set( LIBVOMSAPI_SO ${LIBVOMSAPI_SO} PARENT_SCOPE )
+		endif(DLOPEN_VOMS_LIBS)
 
 	endif(NOT PROPER)
 
-- 
2.20.1

