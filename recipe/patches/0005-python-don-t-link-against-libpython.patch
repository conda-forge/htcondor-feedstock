From c0df6dc0e910db237a8fdc8de36f42689a05317d Mon Sep 17 00:00:00 2001
From: Duncan Macleod <duncan.macleod@ligo.org>
Date: Fri, 14 Jan 2022 11:36:01 +0000
Subject: [PATCH 05/13] python: don't link against libpython

---
 build/cmake/CondorConfigure.cmake | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/build/cmake/CondorConfigure.cmake b/build/cmake/CondorConfigure.cmake
index 10d3d99d4a..7ddba4c2aa 100644
--- a/build/cmake/CondorConfigure.cmake
+++ b/build/cmake/CondorConfigure.cmake
@@ -134,7 +134,13 @@ if(NOT WINDOWS)
 
 		set(PYTHON3_EXECUTABLE        ${Python3_EXECUTABLE})
 
-		set(PYTHON3_LIBRARIES "${PYTHON3_LIB}")
+		# in conda builds we don't want to actually link against libpython
+		if (APPLE)
+			set(PYTHON3_LIBRARIES "-Wl,-undefined,dynamic_lookup")
+		else()
+			set(PYTHON3_LIBRARIES "")
+		endif()
+		set(PYTHON3LIBS_FOUND TRUE)
 
 		# where to install the Python library
 		set(C_PYTHON3ARCHLIB ${Python3_SITEARCH})
-- 
2.43.0

